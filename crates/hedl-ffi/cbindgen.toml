# cbindgen configuration for HEDL FFI
# Generates C header file (hedl.h) from Rust FFI bindings

# Language settings
language = "C"
cpp_compat = true

# Header settings
header = """
/*
 * Dweve HEDL - Hierarchical Entity Data Language
 *
 * Copyright (c) 2025 Dweve IP B.V. and individual contributors.
 *
 * SPDX-License-Identifier: Apache-2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at:
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @file hedl.h
 * @brief HEDL C FFI Interface
 *
 * This header provides C bindings for the HEDL (Hierarchical Entity Data Language)
 * parser and converter library.
 *
 * # Memory Management
 *
 * **IMPORTANT:** Memory ownership follows strict rules:
 *
 * - Strings returned by hedl_* functions MUST be freed with hedl_free_string()
 * - Byte arrays returned by hedl_to_parquet() MUST be freed with hedl_free_bytes()
 * - Documents MUST be freed with hedl_free_document()
 * - Diagnostics MUST be freed with hedl_free_diagnostics()
 *
 * **WARNING:** The hedl_free_* functions ONLY accept pointers allocated by HEDL.
 * Passing pointers from malloc/calloc or other libraries causes undefined behavior.
 * NULL is safe and will be ignored.
 *
 * # Thread Safety
 *
 * Error messages are stored in thread-local storage. Each thread maintains its
 * own error state independently:
 *
 * - hedl_get_last_error() returns the error for the CALLING thread only
 * - Errors from one thread will NOT overwrite errors in another thread
 * - You MUST call hedl_get_last_error() from the same thread that received the error
 *
 * Document handles (HedlDocument*) are NOT thread-safe. Do not share document
 * handles between threads without external synchronization.
 *
 * # Error Handling
 *
 * All functions return error codes (HEDL_OK = 0 on success, negative on failure).
 * Use hedl_get_last_error() to get detailed error messages.
 *
 * # Example Usage
 *
 * @code{.c}
 * #include "hedl.h"
 * #include <stdio.h>
 * #include <stdlib.h>
 *
 * int main() {
 *     const char* hedl_source = "%VERSION: 1.0\n---\nname: Alice\nage: 30\n";
 *     HedlDocument* doc = NULL;
 *
 *     // Parse HEDL document
 *     int result = hedl_parse(hedl_source, -1, 1, &doc);
 *     if (result != HEDL_OK) {
 *         fprintf(stderr, "Parse error: %s\n", hedl_get_last_error());
 *         return 1;
 *     }
 *
 *     // Convert to JSON
 *     char* json = NULL;
 *     result = hedl_to_json(doc, 0, &json);
 *     if (result == HEDL_OK) {
 *         printf("%s\n", json);
 *         hedl_free_string(json);
 *     }
 *
 *     // Clean up
 *     hedl_free_document(doc);
 *     return 0;
 * }
 * @endcode
 */
"""

# Include guard
include_guard = "HEDL_H"
pragma_once = true

# Include standard headers
sys_includes = ["stdint.h", "stdbool.h"]

# Style settings
tab_width = 4
line_length = 100
documentation_style = "c"
documentation_length = "full"

# Namespace and prefix
namespace = "hedl"

# Export settings
[export]
include = [
    "HedlDocument",
    "HedlDiagnostics",
    "HEDL_OK",
    "HEDL_ERR_NULL_PTR",
    "HEDL_ERR_INVALID_UTF8",
    "HEDL_ERR_PARSE",
    "HEDL_ERR_CANONICALIZE",
    "HEDL_ERR_JSON",
    "HEDL_ERR_ALLOC",
    "HEDL_ERR_YAML",
    "HEDL_ERR_XML",
    "HEDL_ERR_CSV",
    "HEDL_ERR_PARQUET",
    "HEDL_ERR_LINT",
    "HEDL_ERR_NEO4J",
    "hedl_parse",
    "hedl_validate",
    "hedl_get_version",
    "hedl_schema_count",
    "hedl_alias_count",
    "hedl_root_item_count",
    "hedl_canonicalize",
    "hedl_lint",
    "hedl_diagnostics_count",
    "hedl_diagnostics_get",
    "hedl_diagnostics_severity",
    "hedl_to_json",
    "hedl_to_yaml",
    "hedl_to_xml",
    "hedl_to_csv",
    "hedl_to_parquet",
    "hedl_to_neo4j_cypher",
    "hedl_from_json",
    "hedl_from_yaml",
    "hedl_from_xml",
    "hedl_from_parquet",
    "hedl_free_string",
    "hedl_free_document",
    "hedl_free_diagnostics",
    "hedl_free_bytes",
    "hedl_get_last_error",
]

# Parse configuration
[parse]
parse_deps = false
clean = true

# Enum configuration
[enum]
rename_variants = "None"

# Struct configuration
[struct]
derive_eq = false
derive_neq = false

# Opaque type settings
[export.rename]
"HedlDocument" = "HedlDocument"
"HedlDiagnostics" = "HedlDiagnostics"
